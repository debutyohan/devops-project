name: my-actions
run-name: ${{ github.actor }} is learning GitHub Actions
on: [push]
jobs:
  # build:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v3
  #     - run: npm i
  #     - run: npm run build
  #     - run: ls -rtl
  #     - uses: actions/cache/save@v3
  #       with:
  #         path: |
  #           node_modules
  #           /home/runner/.cache/Cypress
  #         key: ${{ runner.os }}-path-file-cache }}
  # test:
  #   needs: build
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v3
  #     - uses: actions/cache/restore@v3
  #       with:
  #         path: |
  #           node_modules
  #           /home/runner/.cache/Cypress
  #         key: ${{ runner.os }}-path-file-cache }}
  #     - run: npm run e2e:headless
  #     - uses: actions/upload-artifact@v3
  #       if: ${{ always() }}
  #       with:
  #         name: videos-cypress-tests
  #         path: cypress/videos
  deploy:
    # needs: test
    runs-on: ubuntu-latest
    steps:
      - run: |
          install -m 600 -D /dev/null ~/.ssh/id_rsa
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          ssh-keyscan -H ${{ secrets.SSH_HOST }} > ~/.ssh/known_hosts
      - run: ssh ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }} "cd ${{ secrets.WORK_DIR }} git pull && pm2 restart npm && exit"
      - run: rm -rf ~/.ssh